Work in progress
----------------

Unify .gitignore files (.gitignore and client/.gitignore). --skip-git option when running `ember init`?

---

Make deployment more fault tolerant, output warnings in bin/ember when dependency symlinks for node_modules and bower_components are not in place (and possibly create them as part of it?).

---

PhoneGap Build: Automate zip create and/or upload and/or download with bash script or rake task?

---

Improve performance of `ember build --watch`? Could not find watchman, falling back to NodeWatcher for file system events. Visit http://www.ember-cli.com/#watchman for more info.

---

- Use LiveReload with PhoneGap developer app and with Rails server. Use Ember's LiveReload for both and pass `--no-autoreload` option to `phonegap serve`?

---

- Is `phonegap serve` needed? Can `rails server` do the same job?

---

# Preparing for Production

## Multiple index pages and rewrite rules

Configure `index.html` to be named `index.rails.html`. For now, we will differentiate between the two HTML root files -- the one generated by PhoneGap, and the one generated by Ember that will be served by our Rails app. Ember's compilation configuration for this is specified in `client/Brocfile.js`, replace the existing `var app = new EmberApp();` line with this:

```javascript
var app = new EmberApp({
  outputPaths: {
    app: {
      html: 'index.rails.html'
    }
  }
});
```

We now need to tell Rails to serve `index.rails.html` instead of `index.html`. We'll do this with the help of the [rack-rewrite](https://github.com/jtrupiano/rack-rewrite) gem, which among other things lets us rewrite URLs on the server without changing the URLs our users see. (In case you're familiar with the Apache web server's rewrite module (mod_rewrite), then you'll find rack-rewrite can perform similar tasks).

rack-rewrite is going to make it so requests for `index.html` are re-routed to `index.rails.html`.

Add the rack-rewrite gem to the `Gemfile`:

```ruby
gem 'rack-rewrite'
```

Run `bundle install` in the Terminal.

Create an initializer at `my-rails-app/config/initializers/rewrite_rules.rb` with this content:

```ruby
Rails.application.config.middleware.insert_before(ActionDispatch::Static, Rack::Rewrite) do
  # Requests for "/" or "/index.html" will respond with "/index.rails.html". This won't
  # be visible in the browser's address bar, users will never know about it.
  rewrite %r{\A/(index\.html)?\z}, '/index.rails.html'
end
```

## Configuring PhoneGap's Index Page

In PhoneGap's `client/wrap/config.xml`, change the `content` element's `src` attribute to be `index.phonegap.html`:

```xml
<content src="index.phonegap.html" />
```

The above change to `config.xml` tells PhoneGap to use `index.phonegap.html` as its default page, instead of `index.html`. At the time of writing, there appears to be a bug in `phonegap serve` that means it ignores this setting, it still expects `index.html`. Workaround this bug for now with a symlink:

```bash
TODO: put symlink instructions here for index.html -> index.phonegap.html
```
---

Not ideal using hash location type in non-PhoneGap web app, URLs have visible hashes. Experiment with something like this in environment.js:

```javascript
  locationType: location.protocol === "file:" ? 'hash' : 'auto',
```
---

Use a .slugignore with Heroku to ignore files (e.g. development settings like `.foreman`):

> The .slugignore file causes files to be removed after you push code to Heroku and before the buildpack runs. This lets you prevent large files from being included in the final slug

Source: https://devcenter.heroku.com/articles/slug-compiler#ignoring-files-with-slugignore

---

Previous devise registrations controller routes

cancel_user_registration GET    /users/cancel(.:format)                    devise/registrations#cancel
       user_registration POST   /users(.:format)                           devise/registrations#create
   new_user_registration GET    /users/sign_up(.:format)                   devise/registrations#new
  edit_user_registration GET    /users/edit(.:format)                      devise/registrations#edit
                         PATCH  /users(.:format)                           devise/registrations#update
                         PUT    /users(.:format)                           devise/registrations#update
                         DELETE /users(.:format)                           devise/registrations#destroy

---

Introduce --skip-ember-build option for RSpec and EmberBuilder.

---

Authentication: ember-simple-auth-devise?

---

Registration: Bulk user registration issues mitigated by email confirmation requirement. Include in spec that non-confirmed user cannot successfully login.

it "requires email confirmation to mitigate bulk user registration"

---

Login: Prevent brute-force with rack-attack or ? Devise num failed attempts? Include in spec.

it "mitigates brute force attacks by locking account after X failed attempts"

---

# EMBER COMPONENTS

We're going to write an Ember component that will set the `document.title` for us.


#### Ember Components

Say you're working on an app that needs an input credit card number field that formatted credit card numbers by displaying spaces to the user between every four digits and for the border to turn green once a valid credit card number has been entered. (TODO: Insert sketch image of a working credit card input) You could write this as an Ember component.

Ember components allow you to define HTML and JavaScript behaviour that work together to perform a specific function. Its a bit like being able to write your own HTML elements.

Some potential Ember components:

- Credit card number input field
- Navigation breadcrumb widget to show where a user is in the site hierarchy, e.g. "Home > Products > Bestsellers"
- Vote Up/Down button

The Ember component you're about to write is going to be used to set the `<title>` element in the page `<head>` from within an Ember view template, and will be named the `document-title` component.

Here's how I'd *like* to be able to use the component from within `client/app/pods/user/new/template.hbs`:

```html
<!-- It'd sure be nice to set the document title to "Please Register" this way: -->
{{document-title title="Please register"}}
```

Add the above line to the top of `client/app/pods/user/new/template.hbs`.

Generate the skeleton for this component using:

```bash
bin/ember generate component document-title --pod
```

This will give the following output and files:

```
installing
  create app/pods/components/document-title/component.js
  create app/pods/components/document-title/template.hbs
installing
  create tests/unit/pods/components/document-title/component-test.js
```

(Notice we've got a new pod named "components".)

Ember components can *optionally* generate HTML markup directly in the view via their associated `template.hbs` file. This component won't need to render HTML, which means we can safely delete the template file at `client/app/pods/components/document-title/template.hbs`.

Open `client/app/pods/components/document-title/component.js` in your text editor. This file is where the behaviour for the component is defined. Change the contents of the file to be the following:

```javascript
import Ember from 'ember';

export default Ember.Component.extend({
  // There's no HTML rendered for this component, so make tagName blank:
  tagName: '',
  
  // init() runs when component is first processed by view
  init: function () {
    // Read the title attribute from the component declaration in the template.
    var newTitle = this.get("title");

    // Update the title in the head element using the document.title attribute:
    document.title = newTitle;

    // Continue with the standard initilization:
    this._super.apply(this, arguments);
  },
});
```

