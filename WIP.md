Work in progress
----------------

Special instructions:
- Create `bin/phonegap` script as detailed here in `bin/phonegap` section (TODO: add link)
- Change phonegap process in `Procfile.development` to this:
```
phonegap: bin/phonegap serve --port 4000
```


---

PhoneGap Build: Automate zip create and/or upload and/or download with bash script or rake task?

---

Improve performance of `ember build --watch`? Could not find watchman, falling back to NodeWatcher for file system events. Visit http://www.ember-cli.com/#watchman for more info.

---

- Use LiveReload with PhoneGap developer app and with Rails server. Use Ember's LiveReload for both and pass `--no-autoreload` option to `phonegap serve`?

---

- Is `phonegap serve` needed? Can `rails server` do the same job?

---

# Preparing for Production

## Multiple index pages and rewrite rules

Configure `index.html` to be named `index.rails.html`. For now, we will differentiate between the two HTML root files -- the one generated by PhoneGap, and the one generated by Ember that will be served by our Rails app. Ember's compilation configuration for this is specified in `client/Brocfile.js`, replace the existing `var app = new EmberApp();` line with this:

```javascript
var app = new EmberApp({
  outputPaths: {
    app: {
      html: 'index.rails.html'
    }
  }
});
```

We now need to tell Rails to serve `index.rails.html` instead of `index.html`. We'll do this with the help of the [rack-rewrite](https://github.com/jtrupiano/rack-rewrite) gem, which among other things lets us rewrite URLs on the server without changing the URLs our users see. (In case you're familiar with the Apache web server's rewrite module (mod_rewrite), then you'll find rack-rewrite can perform similar tasks).

rack-rewrite is going to make it so requests for `index.html` are re-routed to `index.rails.html`.

Add the rack-rewrite gem to the `Gemfile`:

```ruby
gem 'rack-rewrite'
```

Run `bundle install` in the Terminal.

Create an initializer at `my-rails-app/config/initializers/rewrite_rules.rb` with this content:

```ruby
Rails.application.config.middleware.insert_before(ActionDispatch::Static, Rack::Rewrite) do
  # Requests for "/" or "/index.html" will respond with "/index.rails.html". This won't
  # be visible in the browser's address bar, users will never know about it.
  rewrite %r{\A/(index\.html)?\z}, '/index.rails.html'
end
```

## Configuring PhoneGap's Index Page

In PhoneGap's `client/wrap/config.xml`, change the `content` element's `src` attribute to be `index.phonegap.html`:

```xml
<content src="index.phonegap.html" />
```

The above change to `config.xml` tells PhoneGap to use `index.phonegap.html` as its default page, instead of `index.html`. At the time of writing, there appears to be a bug in `phonegap serve` that means it ignores this setting, it still expects `index.html`. Workaround this bug for now with a symlink:

```bash
TODO: put symlink instructions here for index.html -> index.phonegap.html
```
---

Not ideal using hash location type in non-PhoneGap web app, URLs have visible hashes. Experiment with something like this in environment.js:

```javascript
  locationType: location.protocol === "file:" ? 'hash' : 'auto',
```
---

Use a .slugignore with Heroku to ignore files (e.g. development settings like `.foreman`):

> The .slugignore file causes files to be removed after you push code to Heroku and before the buildpack runs. This lets you prevent large files from being included in the final slug

Source: https://devcenter.heroku.com/articles/slug-compiler#ignoring-files-with-slugignore

---
