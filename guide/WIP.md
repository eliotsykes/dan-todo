Work in progress
----------------

Unify .gitignore files (.gitignore and client/.gitignore). --skip-git option when running `ember init`?





---

PhoneGap Build: Automate zip create and/or upload and/or download with bash script or rake task?





---

Improve performance of `ember build --watch`? Could not find watchman, falling back to NodeWatcher for file system events. Visit http://www.ember-cli.com/#watchman for more info.







---

- Is `phonegap serve` needed? Can `rails server` do the same job? Write rack middleware that does what connect-phonegap does? e.g. serve zip at /__app_zip__






---

# RACK REWRITE/Preparing for Production

## Multiple index pages and rewrite rules

Configure `index.html` to be named `index.rails.html`. For now, we will differentiate between the two HTML root files -- the one generated by PhoneGap, and the one generated by Ember that will be served by our Rails app. Ember's compilation configuration for this is specified in `client/Brocfile.js`, replace the existing `var app = new EmberApp();` line with this:

```javascript
var app = new EmberApp({
  outputPaths: {
    app: {
      html: 'index.rails.html'
    }
  }
});
```

We now need to tell Rails to serve `index.rails.html` instead of `index.html`. We'll do this with the help of the [rack-rewrite](https://github.com/jtrupiano/rack-rewrite) gem, which among other things lets us rewrite URLs on the server without changing the URLs our users see. (In case you're familiar with the Apache web server's rewrite module (mod_rewrite), then you'll find rack-rewrite can perform similar tasks).

rack-rewrite is going to make it so requests for `index.html` are re-routed to `index.rails.html`.

Add the rack-rewrite gem to the `Gemfile`:

```ruby
gem 'rack-rewrite'
```

Run `bundle install` in the Terminal.

Create an initializer at `my-rails-app/config/initializers/rewrite_rules.rb` with this content:

```ruby
Rails.application.config.middleware.insert_before(ActionDispatch::Static, Rack::Rewrite) do
  # Requests for "/" or "/index.html" will respond with "/index.rails.html". This won't
  # be visible in the browser's address bar, users will never know about it.
  rewrite %r{\A/(index\.html)?\z}, '/index.rails.html'
end
```

## Configuring PhoneGap's Index Page

In PhoneGap's `client/wrap/config.xml`, change the `content` element's `src` attribute to be `index.phonegap.html`:

```xml
<content src="index.phonegap.html" />
```

The above change to `config.xml` tells PhoneGap to use `index.phonegap.html` as its default page, instead of `index.html`. At the time of writing, there appears to be a bug in `phonegap serve` that means it ignores this setting, it still expects `index.html`. Workaround this bug for now with a symlink:

```bash
TODO: put symlink instructions here for index.html -> index.phonegap.html
```






---

Not ideal using hash location type in non-PhoneGap web app, URLs have visible hashes. Experiment with something like this in environment.js:

```javascript
  locationType: location.protocol === "file:" ? 'hash' : 'auto',
```
---








Use a .slugignore with Heroku to ignore files (e.g. development settings like `.foreman`):

> The .slugignore file causes files to be removed after you push code to Heroku and before the buildpack runs. This lets you prevent large files from being included in the final slug

Source: https://devcenter.heroku.com/articles/slug-compiler#ignoring-files-with-slugignore







---

Previous devise registrations controller routes

cancel_user_registration GET    /users/cancel(.:format)                    devise/registrations#cancel
       user_registration POST   /users(.:format)                           devise/registrations#create
   new_user_registration GET    /users/sign_up(.:format)                   devise/registrations#new
  edit_user_registration GET    /users/edit(.:format)                      devise/registrations#edit
                         PATCH  /users(.:format)                           devise/registrations#update
                         PUT    /users(.:format)                           devise/registrations#update
                         DELETE /users(.:format)                           devise/registrations#destroy










---

Introduce --skip-ember-build option for RSpec and EmberBuilder.




---

Registration: Bulk user registration issues mitigated by email confirmation requirement. Include in spec that non-confirmed user cannot successfully login.

it "requires email confirmation to mitigate bulk user registration"







---

Login: Prevent brute-force with rack-attack or ? Devise num failed attempts? Include in spec.

it "mitigates brute force attacks by locking account after X failed attempts"




---

#### Rails Static Router


Our Ember application is a Single Page Application (SPA). This means that all of its pages are effectively served from the single `index.html` file.

To make our jobs easier building a SPA in Rails, we're going to introduce [rails-static-router](https://github.com/eliotsykes/rails-static-router), which is a way to declare the same static file to be served at multiple paths in `config/routes.rb`.

Create a new initializer at `config/initializers/static_router.rb`, and copy and paste in the contents of this file: https://raw.githubusercontent.com/eliotsykes/rails-static-router/master/static_router.rb

Make this line the first route in `config/routes.rb`:

```ruby
  get "/register", to: static("index.html"), as: :register
```
OR this?
```ruby
  # def static_index_route(name)
    # Define the anchor (#fragment-identifier) so the generated URLs are
    # supported by Ember for browsers that need to use the locationType:hash
    # configuration (i.e. browsers that don't have complete support of HTML5
    # History API).
    # get "/#{name}", as: name, to: static("index.html"), defaults: { anchor: "/#{name}" }
  # end

  # These path+anchor routes are tolerant URLs that'll work in a range of browsers. They ought to be used
  # in links in emails.
  # get '/register', as: :register, to: static("index.html"), defaults: { anchor: "/register" }
  # get '/login', as: :login, to: static("index.html"), defaults: { anchor: "/login" }
  # static_index_route :register
  # static_index_route :login
```

Thanks to this new route, requests for `/register/` will be served Ember's index.html. You can also access the related URL helper methods `register_path` and `register_url` throughout your Rails app (for example in your tests and in mail templates) whenever you need to generate a URL for registering a new user.

Re-run the spec and see the next failure.







---

What about PhoneGap Developer App and the apiHost? Test it once 0.16.2 of connect-phonegap is released and add configuration now above if needed. Currently symlink-containing apps not working with 0.16 https://github.com/phonegap/connect-phonegap/pull/116





---

# Build login before registration

Move login (feature spec & form) chapter to *before* registration chapter. Acceptable to have login only available to manually created users initially. Then the registration spec can include login at the end more smoothly.
